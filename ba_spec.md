# Задание на проработку: Калькулятор-прогнозист доходности по вкладам

### Контекст возникновения задачи:

**Текущая ситуация:** Клиент банка может видеть в приложении только текущий баланс своего вклада. Для того чтобы спрогнозировать доходность, особенно с учетом планируемых пополнений, ему необходимо либо обращаться в колл-центр, либо проводить расчеты самостоятельно, что неудобно и часто приводит к ошибкам.

**Проблема:** Отсутствие простого и наглядного инструмента для финансового планирования снижает вовлеченность клиентов и упускает возможность стимулировать их к дополнительным вложениям. Клиент не видит, как его действия могут повлиять на итоговый доход.

**Бизнес-цель:** Предоставить клиентам интерактивный сервис, который повысит их лояльность, мотивирует увеличивать сумму вкладов и снизит нагрузку на службу поддержки.

---

### Что необходимо сделать:

1.  **Разработать "Калькулятор-прогнозист"** как новый функционал в разделе "Мои вклады".
2.  **Интегрироваться с существующим API** (`GET /api/deposits`) для получения списка реальных вкладов клиента.
3.  **Реализовать автозаполнение:** При выборе конкретного вклада, калькулятор должен автоматически подгружать и делать нередактируемыми его базовые параметры: текущую сумму, ставку, дату открытия, срок и валюту.
4.  **Предоставить возможность прогнозирования:** Клиент должен иметь возможность добавлять одно или несколько **гипотетических пополнений** (сумма и дата).
5.  **Добавить опцию реинвестирования:** Реализовать чекбокс "Учитывать реинвестирование процентов", который будет симулировать добавление начисленных процентов к основной сумме вклада в день их выплаты.
6.  **Реализовать логику расчета на Front-End** в строгом соответствии с утвержденными бизнес-правилами.
7.  **Отобразить результат:** По итогам расчета наглядно показать клиенту:
    *   Общую сумму прогнозируемых процентов.
    *   Итоговую сумму на счете в конце срока.
    *   Детализацию начисленных процентов по каждому месяцу.

---

### Критерии приемки:

1.  **Выбор вклада:** Функционал корректно получает и отображает список действующих вкладов клиента. При выборе вклада все его параметры (сумма, ставка, дата и т.д.) без ошибок подставляются в калькулятор.
2.  **Добавление пополнений:** Пользователь может без проблем добавить одно или несколько гипотетических пополнений.
3.  **Опция реинвестирования:** Чекбокс реинвестирования доступен и влияет на итоговый расчет.
4.  **Расчет соответствует правилу "30 дней":** Проценты за 31-е число не начисляются, февраль дополняется до 30 дней, последний месяц полного срока — 29 дней.
5.  **Расчет соответствует правилу "Пополнения":** Довложения начинают влиять на расчет процентов только **со следующего дня**.
6.  **Расчет соответствует правилу "Реинвестирования":** Если опция включена, начисленные за месяц проценты добавляются к основной сумме в день выплаты и учитываются в расчетах со следующего дня.
7.  **Расчет соответствует правилу "Первого дня":** День открытия вклада не участвует в начислении процентов.
8.  **Тестовый сценарий проходит:** Расчет для эталонного примера дает в точности ожидаемый результат.
    *   **Входные данные:**
        *   Начальная сумма: 100 000 KGS (из API)
        *   Дата открытия: 03.03.2025 (из API)
        *   Срок: 12 мес. (из API)
        *   Ставка: 16.50% (из API)
        *   Реинвестирование процентов: `false`
        *   Гипотетические пополнения:
            *   09.04.2025: +4000
            *   12.05.2025: +4000
            *   09.06.2025: +4000
    *   **Ожидаемый результат:**
        *   Накопленные проценты: **18 060.17 KGS**
        *   Сумма в конце срока: **130 060.17 KGS**

## 1. Концепция и бизнес-цели

### 1.1. Концепция
Создать интерактивный инструмент ("калькулятор-прогнозист") в мобильном приложении/интернет-банке, который позволяет клиенту на основе его **реального, существующего вклада** спрогнозировать будущую доходность с учетом гипотетических действий: дополнительных вложений и реинвестирования процентов.

### 1.2. Бизнес-цели
*   **Повышение вовлеченности:** Дать клиентам интерактивный инструмент для управления своими финансами, увеличивая частоту и глубину сессий.
*   **Стимулирование пополнений:** Наглядно демонстрируя, как довложения влияют на итоговый доход, мотивировать клиентов чаще пополнять свои вклады.
*   **Удержание средств:** Повысить лояльность за счет предоставления прозрачного и полезного сервиса для финансового планирования.
*   **Снижение нагрузки на колл-центр:** Предоставить ответы на частые вопросы о доходности вкладов в автоматическом режиме.

## 2. Пользовательский сценарий (User Flow)

1.  Клиент авторизуется в системе и переходит в раздел "Мои вклады".
2.  Он видит список своих активных депозитов. Рядом с каждым депозитом (или в его деталях) присутствует кнопка/ссылка "Рассчитать прогноз".
3.  Клиент нажимает на эту кнопку.
4.  Открывается интерфейс калькулятора-прогнозиста. Поля "Текущая сумма", "Валюта", "Ставка", "Дата открытия", "Срок" **автоматически заполняются данными** из выбранного реального вклада. Эти поля не редактируются.
5.  Ниже пользователю доступны интерактивные элементы:
    *   Кнопка "Добавить планируемое пополнение", которая позволяет указать дату и сумму гипотетического довклада. Можно добавить несколько таких пополнений.
    *   Чекбокс "Учитывать реинвестирование процентов" (или аналогичный по смыслу).
6.  Клиент вводит желаемые гипотетические данные и нажимает кнопку "Рассчитать".
7.  Система отображает результат: общую сумму накопленных процентов, итоговую сумму в конце срока и детализацию по месяцам.

## 3. Функциональные требования

### 3.1. Источник данных для автозаполнения
Для получения данных по реальным вкладам клиента необходимо использовать существующий API-метод `GET /api/deposits`.
*   **Обязательные поля для получения:** `accBal` (текущий баланс), `beginDate` (дата открытия), `period` (срок), `percent` (ставка), `currency` (валюта).

### 3.2. Бизнес-правила для расчета прогноза
Расчет должен строго следовать приведенным ниже правилам:

1.  **База для расчета:** Год условно принимается за 360 дней.
2.  **День открытия:** Не участвует в начислении процентов. Начисления начинаются со следующего дня.
3.  **Правило "30 дней в месяце":**
    *   Каждый полный месяц срока вклада для расчетов считается как 30-дневный.
    *   Проценты за 31-е число любого месяца не начисляются.
    *   Для февраля к фактическому количеству дней (28 или 29) добавляются "виртуальные" дни, чтобы в сумме получилось 30.
    *   Последний месяц срока для полного годового цикла считается как 29-дневный.
4.  **Правило учета пополнений:**
    *   Гипотетическое пополнение, добавленное пользователем, учитывается в расчете процентов только **со следующего дня**.
    *   В день пополнения проценты начисляются на сумму **до** пополнения.
5.  **Правило реинвестирования процентов:**
    *   Эта опция симулирует ручное пополнение вклада на сумму выплаченных процентов.
    *   **День выплаты:** Выплата процентов происходит в то же число месяца, в которое был открыт вклад (например, открыт 3 марта, выплата — 3 апреля, 3 мая и т.д.).
    *   Если опция активна, в день выплаты сумма накопленных за период процентов добавляется к основной сумме вклада и начинает участвовать в расчетах со следующего дня.

## 4. Задачи для анализа

Команде бизнес-аналитиков необходимо:

1.  **Проанализировать реализуемость:** Оценить, возможно ли реализовать описанный функционал с технической и ресурсной точки зрения.
2.  **Проверить источники данных:** Подтвердить, что API `GET /api/deposits` действительно отдает все необходимые и корректные данные для старта расчетов. Убедиться в отсутствии противоречий.
3.  **Детализировать требования:** Описать полные требования к пользовательскому интерфейсу (UI/UX), включая обработку ошибок (например, если API не вернул данные).
4.  **Оценить влияние на системы:** Определить, какие системы банка, помимо фронтенда, будут затронуты (если будут).
5.  **Подготовить User Stories:** Сформировать набор пользовательских историй для команды разработки.
6.  **Провести оценку трудозатрат:** Совместно с командой разработки дать предварительную оценку времени, необходимого на реализацию проекта.

---
*Приложение: Для тестирования алгоритма можно использовать эталонный пример из предыдущей версии ТЗ.* 